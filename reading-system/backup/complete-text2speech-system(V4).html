<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²æ–‡æœ—è®€å­¸ç¿’ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* åˆå§‹è¼‰å…¥ç•«é¢ */
        #setupScreen {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-header h1 {
            color: #5a67d8;
            margin-bottom: 10px;
        }

        .setup-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-card:hover {
            border-color: #5a67d8;
            background: #f7fafc;
        }

        .option-card.selected {
            border-color: #5a67d8;
            background: #ebf8ff;
        }

        .option-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .option-card p {
            color: #718096;
            font-size: 14px;
        }

        /* ç›®éŒ„èˆ‡èª²æ–‡é¸æ“‡ */
        #selectionScreen {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .selection-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }

        .panel {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .directory-list, .lesson-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .directory-item, .lesson-item {
            padding: 12px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .directory-item:hover, .lesson-item:hover {
            background: #e6fffa;
            border-color: #4fd1c5;
        }

        .directory-item.selected, .lesson-item.selected {
            background: #bee3f8;
            border-color: #5a67d8;
            font-weight: bold;
        }

        /* ä¸»è¦å­¸ç¿’ä»‹é¢ */
        #mainInterface {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-button {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .control-button.active {
            background: #5a67d8;
            color: white;
        }

        .play-button {
            background: #48bb78;
            color: white;
            font-size: 18px;
            padding: 12px 30px;
        }

        .play-button:hover {
            background: #38a169;
        }

        /* æ–‡å­—ç¶²æ ¼ */
        .text-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            min-height: 500px;
        }

        .text-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            padding: 5px;
        }

        .text-cell:hover {
            background: #fef5e7;
            border-color: #f39c12;
            transform: scale(1.05);
        }

        .text-cell.playing {
            background: #d5f4e6;
            border-color: #27ae60;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .main-char {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }

        .zhuyin {
            font-size: 14px;
            color: #e74c3c;
            margin-top: 5px;
        }

        /* åˆ†é æ§åˆ¶ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .page-button {
            padding: 8px 16px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .page-button:hover:not(:disabled) {
            background: #4c51bf;
        }

        .page-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 16px;
            font-weight: bold;
            color: #4a5568;
        }

        /* æ‰‹å‹•è¼¸å…¥å€ */
        .manual-input {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }

        .manual-input textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
        }

        .manual-input button {
            margin-top: 10px;
            padding: 10px 30px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        /* æª”æ¡ˆé¸æ“‡å™¨ */
        .file-selector {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }

        .file-input-wrapper {
            margin: 10px 0;
        }

        .file-input-wrapper label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }

        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            background: white;
        }

        /* æç¤ºè¨Šæ¯ */
        .info-message {
            background: #ebf8ff;
            border-left: 4px solid #3182ce;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-message {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        /* è¿”å›æŒ‰éˆ• */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: white;
            border: 2px solid #5a67d8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            color: #5a67d8;
            font-weight: bold;
            z-index: 1000;
        }

        .back-button:hover {
            background: #5a67d8;
            color: white;
        }
    </style>
</head>
<body>
    <!-- è¿”å›æŒ‰éˆ• -->
    <button class="back-button" onclick="backToSetup()" style="display: none;">â† è¿”å›</button>

    <!-- è¨­å®šç•«é¢ -->
    <div id="setupScreen">
        <div class="setup-header">
            <h1>ğŸ“š èª²æ–‡æœ—è®€å­¸ç¿’ç³»çµ±</h1>
            <p>è«‹é¸æ“‡è³‡æ–™è¼‰å…¥æ–¹å¼</p>
        </div>

        <div class="setup-options">
            <div class="option-card" onclick="selectMode('github')">
                <h3>ğŸŒ GitHub/ç·šä¸Šæ¨¡å¼</h3>
                <p>ä½¿ç”¨é è¨­çš„èª²æ–‡è³‡æ–™<br>é©ç”¨æ–¼ GitHub Pages æˆ–ç·šä¸Šå±•ç¤º</p>
            </div>
            <div class="option-card" onclick="selectMode('local')">
                <h3>ğŸ’» æœ¬æ©Ÿæª”æ¡ˆæ¨¡å¼</h3>
                <p>é¸æ“‡æœ¬æ©Ÿçš„èª²æ–‡æª”æ¡ˆ<br>é©ç”¨æ–¼æœ¬æ©Ÿæ¸¬è©¦</p>
            </div>
            <div class="option-card" onclick="selectMode('manual')">
                <h3>âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼</h3>
                <p>ç›´æ¥è¼¸å…¥èª²æ–‡å…§å®¹<br>é©ç”¨æ–¼å¿«é€Ÿæ¸¬è©¦</p>
            </div>
            <div class="option-card" onclick="selectMode('demo')">
                <h3>ğŸ¯ å±•ç¤ºæ¨¡å¼</h3>
                <p>ä½¿ç”¨å…§å»ºç¯„ä¾‹èª²æ–‡<br>ç«‹å³é«”é©—ç³»çµ±åŠŸèƒ½</p>
            </div>
        </div>

        <!-- GitHubæ¨¡å¼è³‡æ–™ç´¢å¼• -->
        <div id="githubModeInfo" class="info-message" style="display: none;">
            <strong>ğŸ“Œ GitHubæ¨¡å¼èªªæ˜ï¼š</strong><br>
            è«‹ç¢ºä¿ä½ çš„ GitHub å°ˆæ¡ˆä¸­æœ‰ data-index.json æª”æ¡ˆï¼Œç”¨ä¾†ç´¢å¼•æ‰€æœ‰èª²æ–‡ã€‚
        </div>

        <!-- æœ¬æ©Ÿæª”æ¡ˆé¸æ“‡ -->
        <div class="file-selector" id="fileSelector">
            <div class="file-input-wrapper">
                <label>é¸æ“‡èª²æ–‡æª”æ¡ˆ (.txt)ï¼š</label>
                <input type="file" id="textFileInput" accept=".txt" multiple>
            </div>
            <button class="control-button" onclick="loadLocalFiles()">è¼‰å…¥æª”æ¡ˆ</button>
        </div>

        <!-- æ‰‹å‹•è¼¸å…¥ -->
        <div class="manual-input" id="manualInput">
            <label><strong>è¼¸å…¥èª²æ–‡å…§å®¹ï¼š</strong></label>
            <textarea id="textInput" placeholder="è«‹è¼¸å…¥èª²æ–‡ï¼Œæ ¼å¼ï¼šå­—(æ³¨éŸ³)
ä¾‹å¦‚ï¼š
æˆ‘(ã„¨ã„›Ë‡)çš„(ã„‰ã„œË™)ç›¸(ã„’ã„§ã„¤)ç°¿(ã„…ã„¨Ë‹)"></textarea>
            <button onclick="loadManualText()">è¼‰å…¥èª²æ–‡</button>
        </div>

        <!-- å±•ç¤ºæ¨¡å¼è‡ªå‹•é–‹å§‹ -->
        <div id="demoModeInfo" class="info-message" style="display: none;">
            <strong>ğŸ¯ å±•ç¤ºæ¨¡å¼ï¼š</strong><br>
            è¼‰å…¥å…§å»ºç¯„ä¾‹èª²æ–‡ä¸­...
        </div>
    </div>

    <!-- ç›®éŒ„èˆ‡èª²æ–‡é¸æ“‡ç•«é¢ -->
    <div id="selectionScreen">
        <div class="selection-container">
            <div class="panel">
                <div class="panel-header">ç›®éŒ„é¸æ“‡</div>
                <div class="directory-list" id="directoryList"></div>
            </div>
            <div class="panel">
                <div class="panel-header">èª²æ–‡é¸æ“‡</div>
                <div class="lesson-list" id="lessonList"></div>
                <button class="control-button play-button" style="width: 100%; margin-top: 20px;" onclick="startLesson()">
                    é–‹å§‹å­¸ç¿’
                </button>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å­¸ç¿’ä»‹é¢ -->
    <div id="mainInterface">
        <div class="control-panel">
            <div class="control-group">
                <span style="color: white; font-weight: bold;">é¡¯ç¤ºæ¨¡å¼ï¼š</span>
                <button class="control-button" onclick="setDisplayMode('char')">åœ‹å­—</button>
                <button class="control-button active" onclick="setDisplayMode('both')">åœ‹å­—+æ³¨éŸ³</button>
                <button class="control-button" onclick="setDisplayMode('zhuyin')">ç´”æ³¨éŸ³</button>
            </div>
            <div class="control-group">
                <button class="control-button play-button" onclick="playAll()">
                    ğŸ”Š å…¨æ–‡å¿µè®€
                </button>
            </div>
            <div class="control-group">
                <span style="color: white; font-weight: bold;">å­—å‹ï¼š</span>
                <select id="fontSelector" class="control-button" onchange="changeFont()">
                    <option value="å¾®è»Ÿæ­£é»‘é«”">å¾®è»Ÿæ­£é»‘é«”</option>
                    <option value="æ¨™æ¥·é«”">æ¨™æ¥·é«”</option>
                    <option value="æ–°ç´°æ˜é«”">æ–°ç´°æ˜é«”</option>
                </select>
            </div>
        </div>

        <div class="text-grid" id="textGrid"></div>

        <div class="pagination">
            <button class="page-button" onclick="previousPage()">ä¸Šä¸€é </button>
            <span class="page-info" id="pageInfo">ç¬¬ 1 é  / å…± 1 é </span>
            <button class="page-button" onclick="nextPage()">ä¸‹ä¸€é </button>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentMode = '';
        let currentData = [];
        let currentPage = 0;
        let totalPages = 1;
        let displayMode = 'both';
        let isPlaying = false;
        let selectedDirectory = '';
        let selectedLesson = '';

        // ç¯„ä¾‹è³‡æ–™çµæ§‹ï¼ˆå±•ç¤ºæ¨¡å¼ç”¨ï¼‰
        const demoData = {
            'è¼¸æ—åœ‹èªä¸€ä¸Š': {
                'ç¬¬ä¸€èª²': [
                    {char: 'ä¸€', zhuyin: 'ã„§'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'æˆ‘', zhuyin: 'ã„¨ã„›Ë‡'},
                    {char: 'çš„', zhuyin: 'ã„‰ã„œË™'},
                    {char: 'ç›¸', zhuyin: 'ã„’ã„§ã„¤'},
                    {char: 'ç°¿', zhuyin: 'ã„…ã„¨Ë‹'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ],
                'ç¬¬äºŒèª²': [
                    {char: 'äºŒ', zhuyin: 'ã„¦Ë‹'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'èº«', zhuyin: 'ã„•ã„£'},
                    {char: 'é«˜', zhuyin: 'ã„ã„ '},
                    {char: 'æ¨¹', zhuyin: 'ã„•ã„¨Ë‹'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªä¸€ä¸‹(èˆŠ)': {
                'ç¬¬ä¸‰èª²': [
                    {char: 'ä¸‰', zhuyin: 'ã„™ã„¢'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'ç¨®', zhuyin: 'ã„“ã„¨ã„¥Ë‹'},
                    {char: 'å­', zhuyin: 'ã„—Ë‡'},
                    {char: 'æ‰¾', zhuyin: 'ã„“ã„ Ë‡'},
                    {char: 'æ–°', zhuyin: 'ã„’ã„§ã„£'},
                    {char: 'å®¶', zhuyin: 'ã„ã„§ã„š'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªä¸€ä¸‹': {
                'ç¬¬å››èª²': [
                    {char: 'å››', zhuyin: 'ã„™Ë‹'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'å°', zhuyin: 'ã„’ã„§ã„ Ë‡'},
                    {char: 'é’', zhuyin: 'ã„‘ã„§ã„¥'},
                    {char: 'è›™', zhuyin: 'ã„¨ã„š'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªäºŒä¸Š': {
                'ç¬¬ä¹èª²': [
                    {char: 'ä¹', zhuyin: 'ã„ã„§ã„¡Ë‡'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'é˜¿', zhuyin: 'ã„š'},
                    {char: 'é‡‘', zhuyin: 'ã„ã„§ã„£'},
                    {char: 'çš„', zhuyin: 'ã„‰ã„œË™'},
                    {char: 'é•·', zhuyin: 'ã„”ã„¤ËŠ'},
                    {char: 'å°¾', zhuyin: 'ã„¨ã„ŸË‡'},
                    {char: 'å·´', zhuyin: 'ã„…ã„š'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªäºŒä¸‹(new)': {
                'ç¬¬åä¸€èª²': [
                    {char: 'å', zhuyin: 'ã„•ËŠ'},
                    {char: 'ä¸€', zhuyin: 'ã„§'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'è³£', zhuyin: 'ã„‡ã„Ë‹'},
                    {char: 'æˆ¿', zhuyin: 'ã„ˆã„¤ËŠ'},
                    {char: 'å­', zhuyin: 'ã„—Ë‡'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªäºŒä¸‹': {
                'ç¬¬åä¸‰èª²': [
                    {char: 'å', zhuyin: 'ã„•ËŠ'},
                    {char: 'ä¸‰', zhuyin: 'ã„™ã„¢'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'ä¸€', zhuyin: 'ã„§'},
                    {char: 'èµ·', zhuyin: 'ã„‘ã„§Ë‡'},
                    {char: 'é¨', zhuyin: 'ã„‘ã„§ËŠ'},
                    {char: 'å–®', zhuyin: 'ã„‰ã„¢'},
                    {char: 'è»Š', zhuyin: 'ã„”ã„œ'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            },
            'è¼¸æ—åœ‹èªäº”ä¸Š': {
                'ç¬¬åäº”èª²': [
                    {char: 'å', zhuyin: 'ã„•ËŠ'},
                    {char: 'äº”', zhuyin: 'ã„¨Ë‡'},
                    {char: 'ã€', zhuyin: 'ã€'},
                    {char: 'å¿«', zhuyin: 'ã„ã„¨ã„Ë‹'},
                    {char: 'æ¨‚', zhuyin: 'ã„Œã„œË‹'},
                    {char: 'å°', zhuyin: 'ã„’ã„§ã„ Ë‡'},
                    {char: 'æ›¸', zhuyin: 'ã„•ã„¨'},
                    {char: 'è¿·', zhuyin: 'ã„‡ã„§ËŠ'},
                    {char: 'ã€‚', zhuyin: 'ã€‚'}
                ]
            }
        };

        // é¸æ“‡æ¨¡å¼
        function selectMode(mode) {
            currentMode = mode;
            
            // éš±è—æ‰€æœ‰é¸é …
            document.getElementById('githubModeInfo').style.display = 'none';
            document.getElementById('fileSelector').style.display = 'none';
            document.getElementById('manualInput').style.display = 'none';
            document.getElementById('demoModeInfo').style.display = 'none';
            
            // é‡è¨­é¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // è¨­å®šé¸ä¸­çš„å¡ç‰‡
            event.currentTarget.classList.add('selected');
            
            switch(mode) {
                case 'github':
                    document.getElementById('githubModeInfo').style.display = 'block';
                    loadGitHubData();
                    break;
                case 'local':
                    document.getElementById('fileSelector').style.display = 'block';
                    break;
                case 'manual':
                    document.getElementById('manualInput').style.display = 'block';
                    break;
                case 'demo':
                    document.getElementById('demoModeInfo').style.display = 'block';
                    setTimeout(() => loadDemoData(), 1000);
                    break;
            }
        }

        // è¼‰å…¥GitHubè³‡æ–™
        async function loadGitHubData() {
            try {
                // å˜—è©¦è¼‰å…¥ data-index.json
                const response = await fetch('data-index.json');
                if (response.ok) {
                    const dataIndex = await response.json();
                    showSelectionScreen(dataIndex);
                } else {
                    // å¦‚æœæ²’æœ‰ç´¢å¼•æª”ï¼Œä½¿ç”¨å±•ç¤ºè³‡æ–™
                    alert('æ‰¾ä¸åˆ° data-index.jsonï¼Œå°‡ä½¿ç”¨å±•ç¤ºæ¨¡å¼');
                    loadDemoData();
                }
            } catch (error) {
                console.error('è¼‰å…¥GitHubè³‡æ–™å¤±æ•—:', error);
                alert('è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨å±•ç¤ºæ¨¡å¼');
                loadDemoData();
            }
        }

        // è¼‰å…¥æœ¬æ©Ÿæª”æ¡ˆ
        function loadLocalFiles() {
            const fileInput = document.getElementById('textFileInput');
            if (fileInput.files.length === 0) {
                alert('è«‹é¸æ“‡è‡³å°‘ä¸€å€‹æª”æ¡ˆ');
                return;
            }
            
            const localData = {};
            let filesRead = 0;
            
            Array.from(fileInput.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const lessonName = file.name.replace('.txt', '');
                    const directory = 'æœ¬æ©Ÿæª”æ¡ˆ';
                    
                    if (!localData[directory]) {
                        localData[directory] = {};
                    }
                    
                    localData[directory][lessonName] = parseText(content);
                    
                    filesRead++;
                    if (filesRead === fileInput.files.length) {
                        showSelectionScreen(localData);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            });
        }

        // è¼‰å…¥æ‰‹å‹•è¼¸å…¥çš„èª²æ–‡
        function loadManualText() {
            const textInput = document.getElementById('textInput').value;
            if (!textInput.trim()) {
                alert('è«‹è¼¸å…¥èª²æ–‡å…§å®¹');
                return;
            }
            
            currentData = parseText(textInput);
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'block';
            document.querySelector('.back-button').style.display = 'block';
            renderPage();
        }

        // è¼‰å…¥å±•ç¤ºè³‡æ–™
        function loadDemoData() {
            showSelectionScreen(demoData);
        }

        // é¡¯ç¤ºé¸æ“‡ç•«é¢
        function showSelectionScreen(data) {
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('selectionScreen').style.display = 'block';
            document.querySelector('.back-button').style.display = 'block';
            
            const directoryList = document.getElementById('directoryList');
            directoryList.innerHTML = '';
            
            Object.keys(data).forEach(dir => {
                const item = document.createElement('div');
                item.className = 'directory-item';
                item.textContent = dir;
                item.onclick = () => selectDirectory(dir, data);
                directoryList.appendChild(item);
            });
        }

        // é¸æ“‡ç›®éŒ„
        function selectDirectory(dir, data) {
            selectedDirectory = dir;
            
            // æ›´æ–°é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.directory-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent === dir) {
                    item.classList.add('selected');
                }
            });
            
            // é¡¯ç¤ºèª²æ–‡åˆ—è¡¨
            const lessonList = document.getElementById('lessonList');
            lessonList.innerHTML = '';
            
            Object.keys(data[dir]).forEach(lesson => {
                const item = document.createElement('div');
                item.className = 'lesson-item';
                item.textContent = lesson;
                item.onclick = () => selectLesson(lesson, data[dir][lesson]);
                lessonList.appendChild(item);
            });
        }

        // é¸æ“‡èª²æ–‡
        function selectLesson(lesson, lessonData) {
            selectedLesson = lesson;
            currentData = lessonData;
            
            // æ›´æ–°é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent === lesson) {
                    item.classList.add('selected');
                }
            });
        }

        // é–‹å§‹å­¸ç¿’
        function startLesson() {
            if (!currentData || currentData.length === 0) {
                alert('è«‹å…ˆé¸æ“‡èª²æ–‡');
                return;
            }
            
            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'block';
            renderPage();
        }

        // è§£æèª²æ–‡
        function parseText(text) {
            const result = [];
            const regex = /(.)\(([^)]+)\)/g;
            let match;
            
            while (match = regex.exec(text)) {
                result.push({
                    char: match[1],
                    zhuyin: match[2]
                });
            }
            
            // è™•ç†æ¨™é»ç¬¦è™Ÿ
            const punctuation = text.replace(/.\([^)]+\)/g, '');
            for (let char of punctuation) {
                if (char.trim()) {
                    result.push({
                        char: char,
                        zhuyin: char
                    });
                }
            }
            
            return result;
        }

        // æ¸²æŸ“é é¢
        function renderPage() {
            const grid = document.getElementById('textGrid');
            grid.innerHTML = '';
            
            const itemsPerPage = 70;
            totalPages = Math.ceil(currentData.length / itemsPerPage);
            
            const start = currentPage * itemsPerPage;
            const end = Math.min(start + itemsPerPage, currentData.length);
            
            for (let i = start; i < end; i++) {
                const cell = document.createElement('div');
                cell.className = 'text-cell';
                cell.onclick = () => playSound(currentData[i].zhuyin, cell);
                
                if (displayMode === 'char' || displayMode === 'both') {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'main-char';
                    charDiv.textContent = currentData[i].char;
                    cell.appendChild(charDiv);
                }
                
                if (displayMode === 'zhuyin' || displayMode === 'both') {
                    const zhuyinDiv = document.createElement('div');
                    zhuyinDiv.className = 'zhuyin';
                    zhuyinDiv.textContent = currentData[i].zhuyin;
                    cell.appendChild(zhuyinDiv);
                }
                
                grid.appendChild(cell);
            }
            
            // è£œé½Šç©ºæ ¼
            const cellCount = end - start;
            const emptyCells = itemsPerPage - cellCount;
            for (let i = 0; i < emptyCells; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'text-cell';
                emptyCell.style.visibility = 'hidden';
                grid.appendChild(emptyCell);
            }
            
            updatePageInfo();
        }

        // æ›´æ–°é é¢è³‡è¨Š
        function updatePageInfo() {
            document.getElementById('pageInfo').textContent = 
                `ç¬¬ ${currentPage + 1} é  / å…± ${totalPages} é `;
            
            document.querySelector('.pagination button:first-child').disabled = currentPage === 0;
            document.querySelector('.pagination button:last-child').disabled = currentPage === totalPages - 1;
        }

        // è¨­å®šé¡¯ç¤ºæ¨¡å¼
        function setDisplayMode(mode) {
            displayMode = mode;
            
            document.querySelectorAll('.control-group:first-child .control-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'char') {
                event.target.classList.add('active');
            } else if (mode === 'both') {
                document.querySelectorAll('.control-group:first-child .control-button')[1].classList.add('active');
            } else {
                document.querySelectorAll('.control-group:first-child .control-button')[2].classList.add('active');
            }
            
            renderPage();
        }

        // æ’­æ”¾è²éŸ³
        async function playSound(zhuyin, element) {
            if (isPlaying) return;
            
            element.classList.add('playing');
            
            try {
                // å»ºç«‹éŸ³æª”è·¯å¾‘
                const soundFile = `sounddata/${zhuyin}.mp3`;
                
                // ä½¿ç”¨ Web Audio API æˆ–å‰µå»º Audio ç‰©ä»¶
                const audio = new Audio(soundFile);
                
                audio.onerror = () => {
                    console.log(`éŸ³æª”ä¸å­˜åœ¨æˆ–ç„¡æ³•æ’­æ”¾: ${soundFile}`);
                    // ä½¿ç”¨ç€è¦½å™¨å…§å»ºçš„èªéŸ³åˆæˆä½œç‚ºå‚™ç”¨
                    const utterance = new SpeechSynthesisUtterance(zhuyin);
                    utterance.lang = 'zh-TW';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                };
                
                audio.onended = () => {
                    element.classList.remove('playing');
                };
                
                await audio.play();
            } catch (error) {
                console.error('æ’­æ”¾å¤±æ•—:', error);
                // ä½¿ç”¨èªéŸ³åˆæˆä½œç‚ºå‚™ç”¨
                const utterance = new SpeechSynthesisUtterance(zhuyin);
                utterance.lang = 'zh-TW';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
                
                setTimeout(() => {
                    element.classList.remove('playing');
                }, 500);
            }
        }

        // å…¨æ–‡å¿µè®€
        async function playAll() {
            if (isPlaying) return;
            
            isPlaying = true;
            const itemsPerPage = 70;
            const start = currentPage * itemsPerPage;
            const end = Math.min(start + itemsPerPage, currentData.length);
            const cells = document.querySelectorAll('.text-cell');
            
            for (let i = 0; i < end - start; i++) {
                if (!isPlaying) break;
                
                const dataIndex = start + i;
                const cell = cells[i];
                
                await new Promise(resolve => {
                    playSound(currentData[dataIndex].zhuyin, cell);
                    
                    // æ ¹æ“šæ¨™é»ç¬¦è™Ÿæ±ºå®šåœé “æ™‚é–“
                    let delay = 300;
                    if (currentData[dataIndex].char === 'ã€‚' || 
                        currentData[dataIndex].char === 'ï¼' || 
                        currentData[dataIndex].char === 'ï¼Ÿ') {
                        delay = 800;
                    } else if (currentData[dataIndex].char === 'ï¼Œ' || 
                               currentData[dataIndex].char === 'ã€') {
                        delay = 500;
                    }
                    
                    setTimeout(resolve, delay);
                });
            }
            
            isPlaying = false;
        }

        // ä¸Šä¸€é 
        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                renderPage();
            }
        }

        // ä¸‹ä¸€é 
        function nextPage() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                renderPage();
            }
        }

        // æ›´æ›å­—å‹
        function changeFont() {
            const font = document.getElementById('fontSelector').value;
            document.querySelectorAll('.main-char').forEach(elem => {
                elem.style.fontFamily = font;
            });
        }

        // è¿”å›è¨­å®šç•«é¢
        function backToSetup() {
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'none';
            document.querySelector('.back-button').style.display = 'none';
            
            // é‡è¨­ç‹€æ…‹
            currentData = [];
            currentPage = 0;
            selectedDirectory = '';
            selectedLesson = '';
            isPlaying = false;
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('mainInterface').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    previousPage();
                } else if (e.key === 'ArrowRight') {
                    nextPage();
                } else if (e.key === ' ') {
                    e.preventDefault();
                    playAll();
                }
            }
        });
    </script>
</body>
</html>