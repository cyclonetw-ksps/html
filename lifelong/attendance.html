<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂúãÂßìÂúãÂ∞èÈÄ≤‰øÆÈÉ®Â≠∏ÁîüÂá∫Â∏≠Ë®òÈåÑÁ≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e1e1e6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(40, 42, 58, 0.9);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.2em;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #a1a1aa;
            font-size: 1.1em;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fbbf24;
            font-size: 1.1em;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(30, 30, 46, 0.8);
            color: #e1e1e6;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
            background: rgba(30, 30, 46, 0.95);
        }
        
        .attendance-section {
            margin-top: 30px;
        }
        
        .attendance-header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 15px;
            border-radius: 12px 12px 0 0;
            margin-bottom: 0;
        }
        
        .attendance-header h3 {
            color: white;
            font-size: 1.3em;
            text-align: center;
        }
        
        .student-table {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: none;
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            background: rgba(59, 130, 246, 0.2);
            padding: 15px;
            font-weight: 600;
            color: #60a5fa;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .student-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s ease;
        }
        
        .student-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .student-row:last-child {
            border-bottom: none;
        }
        
        .student-name {
            font-weight: 500;
            color: #e1e1e6;
            display: flex;
            align-items: center;
        }
        
        .checkbox-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .custom-checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .custom-checkbox.present {
            border-color: #10b981;
        }
        
        .custom-checkbox.present:checked {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
        }
        
        .custom-checkbox.present:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        
        .custom-checkbox.absent {
            border-color: #f59e0b;
        }
        
        .custom-checkbox.absent:checked {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-color: #f59e0b;
        }
        
        .custom-checkbox.absent:checked::after {
            content: '‚ñ≥';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        
        .submit-btn:disabled {
            background: rgba(107, 114, 128, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
            color: #fbbf24;
        }
        
        .success-message {
            display: none;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            color: #10b981;
            text-align: center;
        }
        
        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            color: #ef4444;
            text-align: center;
        }
        
        .export-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .export-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .export-header h3 {
            color: #a855f7;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .export-controls {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: end;
            margin-bottom: 20px;
        }
        
        .export-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #a855f7, #9333ea);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .export-btn:hover {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header, .student-row {
                grid-template-columns: 2fr 1fr 1fr;
                font-size: 14px;
            }
            
            .export-controls {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã ÂúãÂßìÂúãÂ∞èÈÄ≤‰øÆÈÉ®Â≠∏ÁîüÂá∫Â∏≠Ë®òÈåÑÁ≥ªÁµ±</h1>
            <p>Êô∫ËÉΩÂåñÂ≠∏ÁîüÂá∫Áº∫Â∏≠ÁÆ°ÁêÜÂπ≥Âè∞</p>
        </div>
        
        <form id="attendanceForm">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="date">üìÖ Êó•Êúü</label>
                    <input type="date" id="date" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="weekday">üìÜ ÊòüÊúü</label>
                    <input type="text" id="weekday" class="form-input" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="course">üìö Ë™≤Á®ã</label>
                    <select id="course" class="form-select" required>
                        <option value="">Ë´ãÈÅ∏ÊìáË™≤Á®ã</option>
                        <option value="ÂúãË™ûËàáÂΩàÊÄß">ÂúãË™ûËàáÂΩàÊÄß</option>
                        <option value="Á§æÊúÉÁîüÊ¥ªËàáÂΩàÊÄß">Á§æÊúÉÁîüÊ¥ªËàáÂΩàÊÄß</option>
                        <option value="ÂúãË™ûËàáËã±Êñá">ÂúãË™ûËàáËã±Êñá</option>
                        <option value="Êï∏Â≠∏ËàáÁßëÂ≠∏">Êï∏Â≠∏ËàáÁßëÂ≠∏</option>                        
                    </select>
                </div>
            </div>
            
            <div class="attendance-section">
                <div class="attendance-header">
                    <h3>üë• Â≠∏ÁîüÂá∫Â∏≠Ë®òÈåÑ</h3>
                </div>
                
                <div class="student-table">
                    <div class="table-header">
                        <div>Â≠∏ÁîüÂßìÂêç</div>
                        <div>Âá∫Â∏≠ ‚úì</div>
                        <div>Ë´ãÂÅá ‚ñ≥</div>
                    </div>
                    <div id="studentList"></div>
                </div>
            </div>
            
            <button type="submit" id="submitBtn" class="submit-btn">
                üíæ ÈÄÅÂá∫Âá∫Â∏≠Ë®òÈåÑ
            </button>
        </form>
        
        <div id="loading" class="loading">
            <p>üì§ Ê≠£Âú®Êèê‰∫§Êï∏Êìö...</p>
        </div>
        
        <div id="successMessage" class="success-message">
            <p>‚úÖ Âá∫Â∏≠Ë®òÈåÑÂ∑≤ÊàêÂäüÊèê‰∫§ÔºÅ</p>
        </div>
        
        <div id="errorMessage" class="error-message">
            <p>‚ùå Êèê‰∫§Â§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑öÊàñÁ®çÂæåÂÜçË©¶„ÄÇ</p>
        </div>
        
        <div class="export-section">
            <div class="export-header">
                <h3>üìä ÊúàÂ†±Ë°®ÂåØÂá∫</h3>
                <p>Ëá™ÂãïÁîüÊàêÊúà‰ªΩÂá∫Â∏≠Áµ±Ë®àÂ†±Ë°®</p>
            </div>
            
            <div class="export-controls">
                <div class="form-group">
                    <label class="form-label" for="exportYear">Âπ¥‰ªΩ (Ê∞ëÂúã)</label>
                    <select id="exportYear" class="form-select">
                        <option value="114">114Âπ¥</option>
                        <option value="115">115Âπ¥</option>
                        <option value="116">116Âπ¥</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="exportMonth">Êúà‰ªΩ</label>
                    <select id="exportMonth" class="form-select">
                        <option value="01">1Êúà</option>
                        <option value="02">2Êúà</option>
                        <option value="03">3Êúà</option>
                        <option value="04">4Êúà</option>
                        <option value="05">5Êúà</option>
                        <option value="06">6Êúà</option>
                        <option value="07">7Êúà</option>
                        <option value="08">8Êúà</option>
                        <option value="09">9Êúà</option>
                        <option value="10">10Êúà</option>
                        <option value="11">11Êúà</option>
                        <option value="12">12Êúà</option>
                    </select>
                </div>
                
                <button type="button" id="exportBtn" class="export-btn">
                    üì• ÂåØÂá∫Â†±Ë°®
                </button>
            </div>
        </div>
    </div>

    <script>
        // Â≠∏ÁîüÂêçÂñÆ - ÂèØÂú®Ê≠§‰øÆÊîπ
        const students = [
            'ÈòÆÊ∞èÂΩ´', 'ÈòÆÁ¥ÖÂ¶Æ', 'ÈòÆÁéÑËéä', 'ËåÉÂÆ•Â´∫', 'ÈªéÁæéÈ¶ô',
            'È¶¨Èä®Â¶§', 'Èô≥Èå¶Ê±ü', 'ÈªéÊ∞èÈäÄ', 'ËåÉÊ∞èÁáïËêç', 'Èô≥Ê∞èÈå¶ÁßÄ'
        ];
        
        // Ë®≠ÂÆö‰ªäÂ§©ÁöÑÊó•Êúü
        document.getElementById('date').valueAsDate = new Date();
        
        // ÊòüÊúüÂ∞çÊáâË°®
        const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
        
        // Êó•ÊúüËÆäÊõ¥ÊôÇËá™ÂãïÊõ¥Êñ∞ÊòüÊúü
        document.getElementById('date').addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const weekday = weekdays[selectedDate.getDay()];
            document.getElementById('weekday').value = weekday;
        });
        
        // ÂàùÂßãÂåñÊòüÊúüÈ°ØÁ§∫
        const today = new Date();
        document.getElementById('weekday').value = weekdays[today.getDay()];
        
        // Ë®≠ÂÆöÁï∂ÂâçÂπ¥Êúà
        const currentYear = today.getFullYear() - 1911; // ËΩâÊèõÁÇ∫Ê∞ëÂúãÂπ¥
        const currentMonth = String(today.getMonth() + 1).padStart(2, '0');
        document.getElementById('exportYear').value = currentYear.toString();
        document.getElementById('exportMonth').value = currentMonth;
        
        // ÁîüÊàêÂ≠∏ÁîüÂàóË°®
        function generateStudentList() {
            const studentListContainer = document.getElementById('studentList');
            studentListContainer.innerHTML = '';
            
            students.forEach((student, index) => {
                const studentRow = document.createElement('div');
                studentRow.className = 'student-row';
                studentRow.innerHTML = `
                    <div class="student-name">${student}</div>
                    <div class="checkbox-container">
                        <input type="checkbox" class="custom-checkbox present" 
                               id="present_${index}" data-student="${student}" data-type="present">
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" class="custom-checkbox absent" 
                               id="absent_${index}" data-student="${student}" data-type="absent">
                    </div>
                `;
                studentListContainer.appendChild(studentRow);
            });
            
            // Ê∑ªÂä†‰∫íÊñ•ÈÇèËºØ
            document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        const studentName = this.getAttribute('data-student');
                        const type = this.getAttribute('data-type');
                        const otherType = type === 'present' ? 'absent' : 'present';
                        
                        // ÂèñÊ∂àÂêåÂ≠∏ÁîüÁöÑÂè¶‰∏ÄÂÄãÈÅ∏È†Ö
                        const otherCheckbox = document.querySelector(`input[data-student="${studentName}"][data-type="${otherType}"]`);
                        if (otherCheckbox) {
                            otherCheckbox.checked = false;
                        }
                    }
                });
            });
        }
        
        // ÂàùÂßãÂåñÂ≠∏ÁîüÂàóË°®
        generateStudentList();
        
        // Ë°®ÂñÆÊèê‰∫§ËôïÁêÜ
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Êî∂ÈõÜË°®ÂñÆÊï∏Êìö
            const formData = {
                date: document.getElementById('date').value,
                weekday: document.getElementById('weekday').value,
                course: document.getElementById('course').value,
                attendance: {}
            };
            
            // È©óË≠âÂøÖÂ°´Ê¨Ñ‰Ωç
            if (!formData.date || !formData.course) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').innerHTML = '<p>‚ùå Ë´ãÂ°´ÂØ´Êó•ÊúüÂíåË™≤Á®ãÔºÅ</p>';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
                return;
            }
            
            // Êî∂ÈõÜÂá∫Â∏≠Êï∏Êìö
            students.forEach(student => {
                const presentCheckbox = document.querySelector(`input[data-student="${student}"][data-type="present"]`);
                const absentCheckbox = document.querySelector(`input[data-student="${student}"][data-type="absent"]`);
                
                if (presentCheckbox.checked) {
                    formData.attendance[student] = '‚úì';
                } else if (absentCheckbox.checked) {
                    formData.attendance[student] = '‚ñ≥';
                } else {
                    formData.attendance[student] = '';
                }
            });
            
            console.log('Ê∫ñÂÇôÊèê‰∫§Âá∫Â∏≠Êï∏Êìö:', formData);
            
            // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // ÈÄôË£°ÈúÄË¶ÅÊõøÊèõÁÇ∫ÊÇ®ÁöÑ Google Apps Script Web App URL
            const ATTENDANCE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLKc9pT7PrZwoBkDqvrYs-5FhMFlDlG-uONqRz9si5TbhEl-27xu4zqemaHuoG30k0FQ/exec';
            
            // Ê™¢Êü•URLÊòØÂê¶Â∑≤Ë®≠ÂÆö
            if (ATTENDANCE_SCRIPT_URL.includes('YOUR_ATTENDANCE_GOOGLE_APPS_SCRIPT')) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').innerHTML = '<p>‚ùå Ë´ãÂÖàË®≠ÂÆö Google Apps Script Web App URLÔºÅ</p>';
                return;
            }
            
            // Êèê‰∫§Êï∏ÊìöÂà∞ Google Sheets
            fetch(ATTENDANCE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                console.log('Êî∂Âà∞ÂõûÊáâ:', response);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                
                // Âú® no-cors Ê®°Âºè‰∏ãÔºåÂÅáË®≠Êèê‰∫§ÊàêÂäü
                if (response.type === 'opaque') {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('successMessage').innerHTML = '<p>‚úÖ Âá∫Â∏≠Ë®òÈåÑÂ∑≤Êèê‰∫§ÔºÅË´ãÊ™¢Êü•Google SheetÁ¢∫Ë™ç„ÄÇ</p>';
                    
                    // ÂèØÈÅ∏ÔºöÊ∏ÖÈô§Ë°®ÂñÆ
                    document.querySelectorAll('.custom-checkbox').forEach(cb => cb.checked = false);
                } else {
                    return response.text().then(text => {
                        try {
                            return JSON.parse(text);
                        } catch (e) {
                            throw new Error('ÂõûÊáâÊ†ºÂºèÈåØË™§: ' + text);
                        }
                    });
                }
            })
            .then(data => {
                if (data && data.success) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.querySelectorAll('.custom-checkbox').forEach(cb => cb.checked = false);
                }
            })
            .catch(error => {
                console.error('Êèê‰∫§ÈåØË™§:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('errorMessage').style.display = 'block';
                
                let errorMsg = '‚ùå Êèê‰∫§Â§±ÊïóÔºö';
                if (error.message.includes('Failed to fetch')) {
                    errorMsg += 'ÁÑ°Ê≥ïÈÄ£Êé•Âà∞Google Apps ScriptÔºåË´ãÊ™¢Êü•URLÊòØÂê¶Ê≠£Á¢∫„ÄÇ';
                } else {
                    errorMsg += error.message;
                }
                
                document.getElementById('errorMessage').innerHTML = `<p>${errorMsg}</p>`;
            });
        });
        
        // ÂåØÂá∫Â†±Ë°®ÂäüËÉΩ
        document.getElementById('exportBtn').addEventListener('click', function() {
            const year = document.getElementById('exportYear').value;
            const month = document.getElementById('exportMonth').value;
            
            console.log(`Ê∫ñÂÇôÂåØÂá∫ ${year}Âπ¥${month}Êúà Âá∫Â∏≠Â†±Ë°®`);
            
            // ÈÄôË£°ÊúÉË™øÁî®ÂæåÁ´ØÁöÑÂåØÂá∫ÂäüËÉΩ
            const exportData = {
                action: 'export',
                year: year,
                month: month
            };
            
            // È°ØÁ§∫ËôïÁêÜ‰∏≠ÁãÄÊÖã
            this.disabled = true;
            this.textContent = 'üìã ËôïÁêÜ‰∏≠...';
            
            // ÂØ¶ÈöõÂåØÂá∫ÈÇèËºØÂ∞áÂú®Apps Script‰∏≠ÂØ¶Áèæ
            setTimeout(() => {
                this.disabled = false;
                this.textContent = 'üì• ÂåØÂá∫Â†±Ë°®';
                alert(`${year}Âπ¥${month}ÊúàÂá∫Â∏≠Â†±Ë°®ÂåØÂá∫ÂäüËÉΩÊ∫ñÂÇô‰∏≠ÔºåË´ãËÅØÁπ´Á≥ªÁµ±ÁÆ°ÁêÜÂì°Ë®≠ÂÆö„ÄÇ`);
            }, 2000);
        });
    </script>
</body>
</html>
