<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹å§“åœ‹å°é€²ä¿®éƒ¨å­¸ç”Ÿå‡ºå¸­è¨˜éŒ„ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e1e1e6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(40, 42, 58, 0.9);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.2em;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #a1a1aa;
            font-size: 1.1em;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fbbf24;
            font-size: 1.1em;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(30, 30, 46, 0.8);
            color: #e1e1e6;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
            background: rgba(30, 30, 46, 0.95);
        }
        
        .attendance-section {
            margin-top: 30px;
        }
        
        .attendance-header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 15px;
            border-radius: 12px 12px 0 0;
            margin-bottom: 0;
        }
        
        .attendance-header h3 {
            color: white;
            font-size: 1.3em;
            text-align: center;
        }
        
        .student-table {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: none;
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            background: rgba(59, 130, 246, 0.2);
            padding: 15px;
            font-weight: 600;
            color: #60a5fa;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .student-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.3s ease;
        }
        
        .student-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .student-row:last-child {
            border-bottom: none;
        }
        
        .student-name {
            font-weight: 500;
            color: #e1e1e6;
            display: flex;
            align-items: center;
        }
        
        .checkbox-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .custom-checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .custom-checkbox.present {
            border-color: #10b981;
        }
        
        .custom-checkbox.present:checked {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
        }
        
        .custom-checkbox.present:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        
        .custom-checkbox.absent {
            border-color: #f59e0b;
        }
        
        .custom-checkbox.absent:checked {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-color: #f59e0b;
        }
        
        .custom-checkbox.absent:checked::after {
            content: 'â–³';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        
        .submit-btn:disabled {
            background: rgba(107, 114, 128, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
            color: #fbbf24;
        }
        
        .success-message {
            display: none;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            color: #10b981;
            text-align: center;
        }
        
        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            color: #ef4444;
            text-align: center;
        }
        
        .export-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .export-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .export-header h3 {
            color: #a855f7;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .export-controls {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: end;
            margin-bottom: 20px;
        }
        
        .export-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #a855f7, #9333ea);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .export-btn:hover {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header, .student-row {
                grid-template-columns: 2fr 1fr 1fr;
                font-size: 14px;
            }
            
            .export-controls {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ åœ‹å§“åœ‹å°é€²ä¿®éƒ¨å­¸ç”Ÿå‡ºå¸­è¨˜éŒ„ç³»çµ±</h1>
            <p>æ™ºèƒ½åŒ–å­¸ç”Ÿå‡ºç¼ºå¸­ç®¡ç†å¹³å°</p>
        </div>
        
        <form id="attendanceForm">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="date">ğŸ“… æ—¥æœŸ</label>
                    <input type="date" id="date" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="weekday">ğŸ“† æ˜ŸæœŸ</label>
                    <input type="text" id="weekday" class="form-input" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="course">ğŸ“š èª²ç¨‹</label>
                    <select id="course" class="form-select" required>
                        <option value="">è«‹é¸æ“‡èª²ç¨‹</option>
                        <option value="åœ‹èªèˆ‡å½ˆæ€§">åœ‹èªèˆ‡å½ˆæ€§</option>
                        <option value="ç¤¾æœƒç”Ÿæ´»èˆ‡å½ˆæ€§">ç¤¾æœƒç”Ÿæ´»èˆ‡å½ˆæ€§</option>
                        <option value="åœ‹èªèˆ‡è‹±æ–‡">åœ‹èªèˆ‡è‹±æ–‡</option>
                        <option value="æ•¸å­¸èˆ‡ç§‘å­¸">æ•¸å­¸èˆ‡ç§‘å­¸</option>                        
                    </select>
                </div>
            </div>
            
            <div class="attendance-section">
                <div class="attendance-header">
                    <h3>ğŸ‘¥ å­¸ç”Ÿå‡ºå¸­è¨˜éŒ„</h3>
                </div>
                
                <div class="student-table">
                    <div class="table-header">
                        <div>å­¸ç”Ÿå§“å</div>
                        <div>å‡ºå¸­ âœ“</div>
                        <div>è«‹å‡ â–³</div>
                    </div>
                    <div id="studentList"></div>
                </div>
            </div>
            
            <button type="submit" id="submitBtn" class="submit-btn">
                ğŸ’¾ é€å‡ºå‡ºå¸­è¨˜éŒ„
            </button>
        </form>
        
        <div id="loading" class="loading">
            <p>ğŸ“¤ æ­£åœ¨æäº¤æ•¸æ“š...</p>
        </div>
        
        <div id="successMessage" class="success-message">
            <p>âœ… å‡ºå¸­è¨˜éŒ„å·²æˆåŠŸæäº¤ï¼</p>
        </div>
        
        <div id="errorMessage" class="error-message">
            <p>âŒ æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚</p>
        </div>
        
        <div class="export-section">
            <div class="export-header">
                <h3>ğŸ“Š æœˆå ±è¡¨åŒ¯å‡º</h3>
                <p>è‡ªå‹•ç”Ÿæˆæœˆä»½å‡ºå¸­çµ±è¨ˆå ±è¡¨</p>
            </div>
            
            <div class="export-controls">
                <div class="form-group">
                    <label class="form-label" for="exportYear">å¹´ä»½ (æ°‘åœ‹)</label>
                    <select id="exportYear" class="form-select">
                        <option value="114">114å¹´</option>
                        <option value="115">115å¹´</option>
                        <option value="116">116å¹´</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="exportMonth">æœˆä»½</label>
                    <select id="exportMonth" class="form-select">
                        <option value="01">1æœˆ</option>
                        <option value="02">2æœˆ</option>
                        <option value="03">3æœˆ</option>
                        <option value="04">4æœˆ</option>
                        <option value="05">5æœˆ</option>
                        <option value="06">6æœˆ</option>
                        <option value="07">7æœˆ</option>
                        <option value="08">8æœˆ</option>
                        <option value="09">9æœˆ</option>
                        <option value="10">10æœˆ</option>
                        <option value="11">11æœˆ</option>
                        <option value="12">12æœˆ</option>
                    </select>
                </div>
                
                <button type="button" id="exportBtn" class="export-btn">
                    ğŸ“¥ åŒ¯å‡ºå ±è¡¨
                </button>
            </div>
        </div>
    </div>

    <script>
        // å­¸ç”Ÿåå–® - å¯åœ¨æ­¤ä¿®æ”¹
        const students = [
            'é˜®æ°å½«', 'é˜®ç´…å¦®', 'é˜®ç„èŠ', 'èŒƒå®¥å«º', 'é»ç¾é¦™',
            'é¦¬éŠ¨å¦¤', 'é™³éŒ¦æ±Ÿ', 'é»æ°éŠ€', 'èŒƒæ°ç‡•è', 'é™³æ°éŒ¦ç§€'
        ];
        
        // è¨­å®šä»Šå¤©çš„æ—¥æœŸ
        document.getElementById('date').valueAsDate = new Date();
        
        // æ˜ŸæœŸå°æ‡‰è¡¨
        const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        
        // æ—¥æœŸè®Šæ›´æ™‚è‡ªå‹•æ›´æ–°æ˜ŸæœŸ
        document.getElementById('date').addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const weekday = weekdays[selectedDate.getDay()];
            document.getElementById('weekday').value = weekday;
        });
        
        // åˆå§‹åŒ–æ˜ŸæœŸé¡¯ç¤º
        const today = new Date();
        document.getElementById('weekday').value = weekdays[today.getDay()];
        
        // è¨­å®šç•¶å‰å¹´æœˆ
        const currentYear = today.getFullYear() - 1911; // è½‰æ›ç‚ºæ°‘åœ‹å¹´
        const currentMonth = String(today.getMonth() + 1).padStart(2, '0');
        document.getElementById('exportYear').value = currentYear.toString();
        document.getElementById('exportMonth').value = currentMonth;
        
        // ç”Ÿæˆå­¸ç”Ÿåˆ—è¡¨
        function generateStudentList() {
            const studentListContainer = document.getElementById('studentList');
            studentListContainer.innerHTML = '';
            
            students.forEach((student, index) => {
                const studentRow = document.createElement('div');
                studentRow.className = 'student-row';
                studentRow.innerHTML = `
                    <div class="student-name">${student}</div>
                    <div class="checkbox-container">
                        <input type="checkbox" class="custom-checkbox present" 
                               id="present_${index}" data-student="${student}" data-type="present">
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" class="custom-checkbox absent" 
                               id="absent_${index}" data-student="${student}" data-type="absent">
                    </div>
                `;
                studentListContainer.appendChild(studentRow);
            });
            
            // æ·»åŠ äº’æ–¥é‚è¼¯
            document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        const studentName = this.getAttribute('data-student');
                        const type = this.getAttribute('data-type');
                        const otherType = type === 'present' ? 'absent' : 'present';
                        
                        // å–æ¶ˆåŒå­¸ç”Ÿçš„å¦ä¸€å€‹é¸é …
                        const otherCheckbox = document.querySelector(`input[data-student="${studentName}"][data-type="${otherType}"]`);
                        if (otherCheckbox) {
                            otherCheckbox.checked = false;
                        }
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–å­¸ç”Ÿåˆ—è¡¨
        generateStudentList();
        
        // è¡¨å–®æäº¤è™•ç†
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // æ”¶é›†è¡¨å–®æ•¸æ“š
            const formData = {
                date: document.getElementById('date').value,
                weekday: document.getElementById('weekday').value,
                course: document.getElementById('course').value,
                attendance: {}
            };
            
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!formData.date || !formData.course) {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').innerHTML = '<p>âŒ è«‹å¡«å¯«æ—¥æœŸå’Œèª²ç¨‹ï¼</p>';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
                return;
            }
            
            // æ”¶é›†å‡ºå¸­æ•¸æ“š
            students.forEach(student => {
                const presentCheckbox = document.querySelector(`input[data-student="${student}"][data-type="present"]`);
                const absentCheckbox = document.querySelector(`input[data-student="${student}"][data-type="absent"]`);
                
                if (presentCheckbox.checked) {
                    formData.attendance[student] = 'âœ“';
                } else if (absentCheckbox.checked) {
                    formData.attendance[student] = 'â–³';
                } else {
                    formData.attendance[student] = '';
                }
            });
            
            console.log('æº–å‚™æäº¤å‡ºå¸­æ•¸æ“š:', formData);
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // é€™è£¡éœ€è¦æ›¿æ›ç‚ºæ‚¨çš„ Google Apps Script Web App URL
            const ATTENDANCE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLKc9pT7PrZwoBkDqvrYs-5FhMFlDlG-uONqRz9si5TbhEl-27xu4zqemaHuoG30k0FQ/exec';
            
            // æª¢æŸ¥URLæ˜¯å¦å·²è¨­å®š
            if (ATTENDANCE_SCRIPT_URL.includes('YOUR_ATTENDANCE_GOOGLE_APPS_SCRIPT')) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').innerHTML = '<p>âŒ è«‹å…ˆè¨­å®š Google Apps Script Web App URLï¼</p>';
                return;
            }
            
            // æäº¤æ•¸æ“šåˆ° Google Sheets
            fetch(ATTENDANCE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                console.log('æ”¶åˆ°å›æ‡‰:', response);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                
                // åœ¨ no-cors æ¨¡å¼ä¸‹ï¼Œå‡è¨­æäº¤æˆåŠŸ
                if (response.type === 'opaque') {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('successMessage').innerHTML = '<p>âœ… å‡ºå¸­è¨˜éŒ„å·²æäº¤ï¼è«‹æª¢æŸ¥Google Sheetç¢ºèªã€‚</p>';
                    
                    // å¯é¸ï¼šæ¸…é™¤è¡¨å–®
                    document.querySelectorAll('.custom-checkbox').forEach(cb => cb.checked = false);
                } else {
                    return response.text().then(text => {
                        try {
                            return JSON.parse(text);
                        } catch (e) {
                            throw new Error('å›æ‡‰æ ¼å¼éŒ¯èª¤: ' + text);
                        }
                    });
                }
            })
            .then(data => {
                if (data && data.success) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.querySelectorAll('.custom-checkbox').forEach(cb => cb.checked = false);
                }
            })
            .catch(error => {
                console.error('æäº¤éŒ¯èª¤:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('errorMessage').style.display = 'block';
                
                let errorMsg = 'âŒ æäº¤å¤±æ•—ï¼š';
                if (error.message.includes('Failed to fetch')) {
                    errorMsg += 'ç„¡æ³•é€£æ¥åˆ°Google Apps Scriptï¼Œè«‹æª¢æŸ¥URLæ˜¯å¦æ­£ç¢ºã€‚';
                } else {
                    errorMsg += error.message;
                }
                
                document.getElementById('errorMessage').innerHTML = `<p>${errorMsg}</p>`;
            });
        });
        
        // åŒ¯å‡ºå ±è¡¨åŠŸèƒ½
        document.getElementById('exportBtn').addEventListener('click', function() {
            const year = document.getElementById('exportYear').value;
            const month = document.getElementById('exportMonth').value;
            
            console.log(`æº–å‚™åŒ¯å‡º ${year}å¹´${month}æœˆ å‡ºå¸­å ±è¡¨`);
            
            // é€™è£¡æœƒèª¿ç”¨å¾Œç«¯çš„åŒ¯å‡ºåŠŸèƒ½
            const exportData = {
                action: 'export',
                year: year,
                month: month
            };
            
            // é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹
            this.disabled = true;
            this.textContent = 'ğŸ“‹ è™•ç†ä¸­...';
            
            // å¯¦éš›åŒ¯å‡ºé‚è¼¯å°‡åœ¨Apps Scriptä¸­å¯¦ç¾
            setTimeout(() => {
                this.disabled = false;
                this.textContent = 'ğŸ“¥ åŒ¯å‡ºå ±è¡¨';
                alert(`${year}å¹´${month}æœˆå‡ºå¸­å ±è¡¨åŒ¯å‡ºåŠŸèƒ½æº–å‚™ä¸­ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡è¨­å®šã€‚`);
            }, 2000);
        });
    </script>
</body>
</html>
